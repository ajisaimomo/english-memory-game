<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±å˜èªç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        .card {
            perspective: 1000px;
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .card-front {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            font-size: 2rem;
        }
        
        .card-back {
            background: white;
            color: #333;
            transform: rotateY(180deg);
            flex-direction: column;
            gap: 10px;
        }
        
        .card-back.word-card {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }
        
        .card-back.icon-card {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
        }
        
        .category-btn {
            transition: all 0.3s ease;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .category-btn.selected {
            background: linear-gradient(45deg, #fd79a8, #fdcb6e) !important;
            color: white;
            transform: scale(1.05);
        }
        
        .matched {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .celebration {
            animation: bounce 0.6s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-30px,0); }
            70% { transform: translate3d(0,-15px,0); }
            90% { transform: translate3d(0,-4px,0); }
        }

        /* è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        .selected-category-tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1.5rem;
            margin: 0.25rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .selected-category-tag:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
        }

        .timer-display {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="p-4">
    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="text-center mb-8">
        <h1 class="text-5xl font-bold text-white mb-4 animate__animated animate__bounceInDown">
            ğŸ® è‹±å˜èªç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ  ğŸ®
        </h1>
        <p class="text-xl text-white animate__animated animate__fadeInUp">
            ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã‚“ã§æ¥½ã—ãè‹±å˜èªã‚’è¦šãˆã‚ˆã†ï¼
        </p>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠç”»é¢ -->
    <div id="categoryScreen" class="max-w-4xl mx-auto">
        <div class="bg-white rounded-3xl p-8 shadow-2xl animate__animated animate__zoomIn">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">
                ğŸ“š ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã¼ã†ï¼ˆæœ€å¤§3ã¤ã¾ã§ï¼‰
            </h2>
            
            <!-- é¸æŠæ¸ˆã¿ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="mb-6">
                <h3 class="text-lg font-bold text-gray-700 mb-3 text-center">é¸æŠæ¸ˆã¿ã‚«ãƒ†ã‚´ãƒª:</h3>
                <div id="selectedCategoriesDisplay" class="min-h-[3rem] bg-gray-100 rounded-2xl p-3 flex flex-wrap items-center justify-center border-2 border-dashed border-gray-300">
                    <span class="text-gray-500">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</span>
                </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                <button class="category-btn bg-pink-400 hover:bg-pink-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="animals">
                    ğŸ¾ å‹•ç‰©
                </button>
                <button class="category-btn bg-green-400 hover:bg-green-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="foods">
                    ğŸ é£Ÿã¹ç‰©
                </button>
                <button class="category-btn bg-purple-400 hover:bg-purple-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="colors">
                    ğŸŒˆ è‰²
                </button>
                <button class="category-btn bg-blue-400 hover:bg-blue-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="numbers">
                    ğŸ”¢ æ•°å­—(1-10)
                </button>
                <button class="category-btn bg-indigo-400 hover:bg-indigo-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="numbers2">
                    ğŸ”¢ æ•°å­—(11-100)
                </button>
                <button class="category-btn bg-yellow-400 hover:bg-yellow-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="vehicles">
                    ğŸš— ä¹—ã‚Šç‰©
                </button>
                <button class="category-btn bg-cyan-400 hover:bg-cyan-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="weather">
                    â˜€ï¸ å¤©æ°—
                </button>
                <button class="category-btn bg-orange-400 hover:bg-orange-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="months">
                    ğŸ“… æœˆ
                </button>
                <button class="category-btn bg-red-400 hover:bg-red-500 text-white p-4 rounded-2xl text-lg font-bold" data-category="days">
                    ğŸ“… æ›œæ—¥
                </button>
            </div>
            
            <div class="text-center">
                <p id="selectedCount" class="text-lg mb-4 text-gray-600">é¸æŠæ¸ˆã¿: 0/3</p>
                <button id="startBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-2xl font-bold py-4 px-8 rounded-full shadow-lg transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    ğŸ¯ ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                </button>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="max-w-6xl mx-auto hidden">
        <div class="bg-white rounded-3xl p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                <h2 class="text-3xl font-bold text-gray-800">ğŸ² ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </h2>
                <div class="flex gap-4 items-center flex-wrap">
                    <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
                    <div class="timer-display text-center">
                        <div class="text-sm text-gray-600">â±ï¸ çµŒéæ™‚é–“</div>
                        <div id="gameTimer" class="text-lg font-bold text-purple-600">00:00</div>
                    </div>
                    <div class="text-lg font-bold text-gray-600">
                        ãƒãƒƒãƒ: <span id="matchCount" class="text-green-600">0</span>/<span id="totalPairs">0</span>
                    </div>
                    <button id="backBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                        â† æˆ»ã‚‹
                    </button>
                </div>
            </div>
            
            <!-- ã‚«ãƒ¼ãƒ‰é…ç½®ã‚¨ãƒªã‚¢ -->
            <div id="gameBoard" class="grid gap-3 mb-6"></div>
            
            <!-- ãƒãƒƒãƒã—ãŸå˜èªè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="matchDisplay" class="text-center p-4 bg-gradient-to-r from-green-400 to-blue-500 rounded-2xl hidden">
                <div class="text-white text-2xl font-bold" id="matchedWord"></div>
                <div class="text-white text-lg" id="matchedMeaning"></div>
            </div>
        </div>
    </div>

    <!-- ã‚¯ãƒªã‚¢ç”»é¢ -->
    <div id="clearScreen" class="max-w-2xl mx-auto hidden">
        <div class="bg-white rounded-3xl p-8 shadow-2xl text-center animate__animated animate__zoomIn">
            <h2 class="text-5xl font-bold text-yellow-500 mb-4">ğŸ‰ ãŠã‚ã§ã¨ã†ï¼ ğŸ‰</h2>
            <p class="text-2xl text-gray-700 mb-4">å…¨ã¦ã®ãƒšã‚¢ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼</p>
            <!-- ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ è¡¨ç¤º -->
            <div class="timer-display text-2xl mb-6 inline-block">
                ğŸ† ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ : <span id="finalTime" class="text-purple-600 font-bold">00:00</span>
            </div>
            <div>
                <button id="playAgainBtn" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white text-xl font-bold py-4 px-8 rounded-full shadow-lg transform transition hover:scale-105">
                    ğŸ”„ ã‚‚ã†ä¸€åº¦éŠã¶
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        const gameData = {
            animals: [
                {word: 'cat', meaning: 'ã­ã“', icon: 'ğŸ±'},
                {word: 'dog', meaning: 'ã„ã¬', icon: 'ğŸ¶'},
                {word: 'bird', meaning: 'ã¨ã‚Š', icon: 'ğŸ¦'},
                {word: 'fish', meaning: 'ã•ã‹ãª', icon: 'ğŸŸ'},
                {word: 'lion', meaning: 'ãƒ©ã‚¤ã‚ªãƒ³', icon: 'ğŸ¦'},
                {word: 'elephant', meaning: 'ãã†', icon: 'ğŸ˜'},
                {word: 'monkey', meaning: 'ã•ã‚‹', icon: 'ğŸµ'},
                {word: 'rabbit', meaning: 'ã†ã•ã', icon: 'ğŸ°'},
                {word: 'bear', meaning: 'ãã¾', icon: 'ğŸ»'},
                {word: 'fox', meaning: 'ãã¤ã­', icon: 'ğŸ¦Š'}
            ],
            foods: [
                {word: 'apple', meaning: 'ã‚Šã‚“ã”', icon: 'ğŸ'},
                {word: 'banana', meaning: 'ãƒãƒŠãƒŠ', icon: 'ğŸŒ'},
                {word: 'orange', meaning: 'ã‚ªãƒ¬ãƒ³ã‚¸', icon: 'ğŸŠ'},
                {word: 'bread', meaning: 'ãƒ‘ãƒ³', icon: 'ğŸ'},
                {word: 'milk', meaning: 'ãƒŸãƒ«ã‚¯', icon: 'ğŸ¥›'},
                {word: 'cheese', meaning: 'ãƒãƒ¼ã‚º', icon: 'ğŸ§€'},
                {word: 'rice', meaning: 'ã”ã¯ã‚“', icon: 'ğŸš'},
                {word: 'egg', meaning: 'ãŸã¾ã”', icon: 'ğŸ¥š'},
                {word: 'meat', meaning: 'ã«ã', icon: 'ğŸ¥©'},
                {word: 'cake', meaning: 'ã‚±ãƒ¼ã‚­', icon: 'ğŸ°'}
            ],
            colors: [
                {word: 'red', meaning: 'ã‚ã‹', icon: 'ğŸ”´'},
                {word: 'blue', meaning: 'ã‚ãŠ', icon: 'ğŸ”µ'},
                {word: 'green', meaning: 'ã¿ã©ã‚Š', icon: 'ğŸŸ¢'},
                {word: 'yellow', meaning: 'ãã„ã‚', icon: 'ğŸŸ¡'},
                {word: 'orange', meaning: 'ã‚ªãƒ¬ãƒ³ã‚¸', icon: 'ğŸŸ '},
                {word: 'purple', meaning: 'ã‚€ã‚‰ã•ã', icon: 'ğŸŸ£'},
                {word: 'pink', meaning: 'ãƒ”ãƒ³ã‚¯', icon: 'ğŸ©·'},
                {word: 'brown', meaning: 'ã¡ã‚ƒã„ã‚', icon: 'ğŸ¤'},
                {word: 'black', meaning: 'ãã‚', icon: 'âš«'},
                {word: 'white', meaning: 'ã—ã‚', icon: 'âšª'}
            ],
            numbers: [
                {word: 'one', meaning: 'ã„ã¡', icon: '1ï¸âƒ£'},
                {word: 'two', meaning: 'ã«', icon: '2ï¸âƒ£'},
                {word: 'three', meaning: 'ã•ã‚“', icon: '3ï¸âƒ£'},
                {word: 'four', meaning: 'ã‚ˆã‚“', icon: '4ï¸âƒ£'},
                {word: 'five', meaning: 'ã”', icon: '5ï¸âƒ£'},
                {word: 'six', meaning: 'ã‚ã', icon: '6ï¸âƒ£'},
                {word: 'seven', meaning: 'ãªãª', icon: '7ï¸âƒ£'},
                {word: 'eight', meaning: 'ã¯ã¡', icon: '8ï¸âƒ£'},
                {word: 'nine', meaning: 'ãã‚…ã†', icon: '9ï¸âƒ£'},
                {word: 'ten', meaning: 'ã˜ã‚…ã†', icon: 'ğŸ”Ÿ'}
            ],
            numbers2: [
                {word: 'eleven', meaning: 'ã˜ã‚…ã†ã„ã¡', icon: 'ğŸ”¢'},
                {word: 'twelve', meaning: 'ã˜ã‚…ã†ã«', icon: 'ğŸ•'},
                {word: 'thirteen', meaning: 'ã˜ã‚…ã†ã•ã‚“', icon: '1ï¸âƒ£3ï¸âƒ£'},
                {word: 'fourteen', meaning: 'ã˜ã‚…ã†ã‚ˆã‚“', icon: '1ï¸âƒ£4ï¸âƒ£'},
                {word: 'fifteen', meaning: 'ã˜ã‚…ã†ã”', icon: '1ï¸âƒ£5ï¸âƒ£'},
                {word: 'twenty', meaning: 'ã«ã˜ã‚…ã†', icon: '2ï¸âƒ£0ï¸âƒ£'},
                {word: 'thirty', meaning: 'ã•ã‚“ã˜ã‚…ã†', icon: '3ï¸âƒ£0ï¸âƒ£'},
                {word: 'fifty', meaning: 'ã”ã˜ã‚…ã†', icon: '5ï¸âƒ£0ï¸âƒ£'},
                {word: 'eighty', meaning: 'ã¯ã¡ã˜ã‚…ã†', icon: '8ï¸âƒ£0ï¸âƒ£'},
                {word: 'hundred', meaning: 'ã²ã‚ƒã', icon: 'ğŸ’¯'}
            ],
            vehicles: [
                {word: 'car', meaning: 'ãã‚‹ã¾', icon: 'ğŸš—'},
                {word: 'bus', meaning: 'ãƒã‚¹', icon: 'ğŸšŒ'},
                {word: 'train', meaning: 'ã§ã‚“ã—ã‚ƒ', icon: 'ğŸšƒ'},
                {word: 'bike', meaning: 'ã˜ã¦ã‚“ã—ã‚ƒ', icon: 'ğŸš²'},
                {word: 'plane', meaning: 'ã²ã“ã†ã', icon: 'âœˆï¸'},
                {word: 'ship', meaning: 'ãµã­', icon: 'ğŸš¢'},
                {word: 'truck', meaning: 'ãƒˆãƒ©ãƒƒã‚¯', icon: 'ğŸšš'},
                {word: 'taxi', meaning: 'ã‚¿ã‚¯ã‚·ãƒ¼', icon: 'ğŸš•'},
                {word: 'rocket', meaning: 'ãƒ­ã‚±ãƒƒãƒˆ', icon: 'ğŸš€'},
                {word: 'helicopter', meaning: 'ãƒ˜ãƒªã‚³ãƒ—ã‚¿ãƒ¼', icon: 'ğŸš'}
            ],
            weather: [
                {word: 'sunny', meaning: 'ã¯ã‚Œ', icon: 'â˜€ï¸'},
                {word: 'cloudy', meaning: 'ãã‚‚ã‚Š', icon: 'â˜ï¸'},
                {word: 'rainy', meaning: 'ã‚ã‚', icon: 'â˜”'},
                {word: 'snowy', meaning: 'ã‚†ã', icon: 'â„ï¸'},
                {word: 'windy', meaning: 'ã‹ãœ', icon: 'ğŸ’¨'},
                {word: 'stormy', meaning: 'ã‚ã‚‰ã—', icon: 'â›ˆï¸'},
                {word: 'foggy', meaning: 'ãã‚Š', icon: 'ğŸŒ«ï¸'},
                {word: 'clear', meaning: 'ã‹ã„ã›ã„', icon: 'âœ¨'}
            ],
            months: [
                {word: 'January', meaning: '1æœˆ', icon: 'â›„'},
                {word: 'February', meaning: '2æœˆ', icon: 'ğŸ«'},
                {word: 'March', meaning: '3æœˆ', icon: 'ğŸŒ¸'},
                {word: 'April', meaning: '4æœˆ', icon: 'ğŸŒ±'},
                {word: 'May', meaning: '5æœˆ', icon: 'ğŸ'},
                {word: 'June', meaning: '6æœˆ', icon: 'ğŸ¸'},
                {word: 'July', meaning: '7æœˆ', icon: 'ğŸ–ï¸'},
                {word: 'August', meaning: '8æœˆ', icon: 'ğŸŒ»'},
                {word: 'September', meaning: '9æœˆ', icon: 'ğŸ‘'},
                {word: 'October', meaning: '10æœˆ', icon: 'ğŸƒ'}
            ],
            days: [
                {word: 'Sunday', meaning: 'ã«ã¡ã‚ˆã†ã³', icon: 'ğŸ“…â˜€ï¸'},
                {word: 'Monday', meaning: 'ã’ã¤ã‚ˆã†ã³', icon: 'ğŸ“…ğŸŒ™'},
                {word: 'Tuesday', meaning: 'ã‹ã‚ˆã†ã³', icon: 'ğŸ“…ğŸ”¥'},
                {word: 'Wednesday', meaning: 'ã™ã„ã‚ˆã†ã³', icon: 'ğŸ“…ğŸ’§'},
                {word: 'Thursday', meaning: 'ã‚‚ãã‚ˆã†ã³', icon: 'ğŸ“…ğŸŒ³'},
                {word: 'Friday', meaning: 'ãã‚“ã‚ˆã†ã³', icon: 'ğŸ“…ğŸ’°'},
                {word: 'Saturday', meaning: 'ã©ã‚ˆã†ã³', icon: 'ğŸ“…ğŸŒ'}
            ]
        };

        // ã‚«ãƒ†ã‚´ãƒªåã®æ—¥æœ¬èªå¯¾å¿œ
        const categoryNames = {
            animals: 'ğŸ¾ å‹•ç‰©',
            foods: 'ğŸ é£Ÿã¹ç‰©',
            colors: 'ğŸŒˆ è‰²',
            numbers: 'ğŸ”¢ æ•°å­—(1-10)',
            numbers2: 'ğŸ”¢ æ•°å­—(11-100)',
            vehicles: 'ğŸš— ä¹—ã‚Šç‰©',
            weather: 'â˜€ï¸ å¤©æ°—',
            months: 'ğŸ“… æœˆ',
            days: 'ğŸ“… æ›œæ—¥'
        };

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let selectedCategories = [];
        let gameCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 0;
        let startTime = 0;
        let gameTimer = null;

        // DOMè¦ç´ 
        const categoryScreen = document.getElementById('categoryScreen');
        const gameScreen = document.getElementById('gameScreen');
        const clearScreen = document.getElementById('clearScreen');
        const categoryButtons = document.querySelectorAll('.category-btn');
        const selectedCountEl = document.getElementById('selectedCount');
        const selectedCategoriesDisplay = document.getElementById('selectedCategoriesDisplay');
        const startBtn = document.getElementById('startBtn');
        const backBtn = document.getElementById('backBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const gameBoard = document.getElementById('gameBoard');
        const matchDisplay = document.getElementById('matchDisplay');
        const matchedWord = document.getElementById('matchedWord');
        const matchedMeaning = document.getElementById('matchedMeaning');
        const matchCount = document.getElementById('matchCount');
        const totalPairsEl = document.getElementById('totalPairs');
        const gameTimerEl = document.getElementById('gameTimer');
        const finalTimeEl = document.getElementById('finalTime');

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        categoryButtons.forEach(btn => {
            btn.addEventListener('click', () => toggleCategory(btn));
        });

        startBtn.addEventListener('click', startGame);
        backBtn.addEventListener('click', backToCategory);
        playAgainBtn.addEventListener('click', resetGame);

        // ã‚«ãƒ†ã‚´ãƒªé¸æŠå‡¦ç†
        function toggleCategory(btn) {
            const category = btn.dataset.category;
            
            if (selectedCategories.includes(category)) {
                selectedCategories = selectedCategories.filter(c => c !== category);
                btn.classList.remove('selected');
            } else {
                if (selectedCategories.length < 3) {
                    selectedCategories.push(category);
                    btn.classList.add('selected');
                }
            }
            
            updateUI();
        }

        // é¸æŠæ¸ˆã¿ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚°ã®å‰Šé™¤
        function removeCategory(category) {
            selectedCategories = selectedCategories.filter(c => c !== category);
            // ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚‚è§£é™¤
            categoryButtons.forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.remove('selected');
                }
            });
            updateUI();
        }

        function updateUI() {
            selectedCountEl.textContent = `é¸æŠæ¸ˆã¿: ${selectedCategories.length}/3`;
            startBtn.disabled = selectedCategories.length === 0;
            
            // é¸æŠæ¸ˆã¿ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤º
            if (selectedCategories.length === 0) {
                selectedCategoriesDisplay.innerHTML = '<span class="text-gray-500">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</span>';
            } else {
                selectedCategoriesDisplay.innerHTML = selectedCategories.map(category => 
                    `<span class="selected-category-tag" onclick="removeCategory('${category}')">
                        ${categoryNames[category]}
                        <i class="fas fa-times"></i>
                    </span>`
                ).join('');
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
        function startTimer() {
            startTime = Date.now();
            gameTimer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            gameTimerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            finalTimeEl.textContent = timeString;
            return timeString;
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            // é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
            gameCards = [];
            selectedCategories.forEach(category => {
                gameData[category].forEach(item => {
                    // è‹±å˜èªã‚«ãƒ¼ãƒ‰ï¼ˆæ—¥æœ¬èªè¡¨ç¤ºãªã—ï¼‰
                    gameCards.push({
                        id: `${category}-${item.word}-word`,
                        type: 'word',
                        content: item.word,
                        meaning: item.meaning,
                        icon: item.icon,
                        pairId: `${category}-${item.word}`
                    });
                    
                    // ã‚¢ã‚¤ã‚³ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆæ—¥æœ¬èªè¡¨ç¤ºã‚ã‚Šï¼‰
                    gameCards.push({
                        id: `${category}-${item.word}-icon`,
                        type: 'icon',
                        content: item.icon,
                        meaning: item.meaning,
                        word: item.word,
                        pairId: `${category}-${item.word}`
                    });
                });
            });

            // ã‚«ãƒ¼ãƒ‰ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            shuffleArray(gameCards);
            
            totalPairs = gameCards.length / 2;
            matchedPairs = 0;
            
            // UIæ›´æ–°
            totalPairsEl.textContent = totalPairs;
            matchCount.textContent = matchedPairs;
            
            // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
            startTimer();
            
            // ã‚²ãƒ¼ãƒ ç”»é¢ã«åˆ‡ã‚Šæ›¿ãˆ
            categoryScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            renderGameBoard();
        }

        // ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰æç”»
        function renderGameBoard() {
            const cols = Math.ceil(Math.sqrt(gameCards.length));
            gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            gameBoard.innerHTML = '';
            
            gameCards.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card h-24 w-full';
                cardEl.dataset.cardId = card.id;
                cardEl.innerHTML = `
                    <div class="card-inner h-full">
                        <div class="card-front">
                            <i class="fas fa-question text-4xl"></i>
                        </div>
                        <div class="card-back ${card.type}-card">
                            <div class="text-2xl">${card.content}</div>
                            ${card.type === 'icon' ? `<div class="text-sm opacity-75">(${card.meaning})</div>` : ''}
                        </div>
                    </div>
                `;
                
                cardEl.addEventListener('click', () => flipCard(cardEl, card));
                gameBoard.appendChild(cardEl);
            });
        }

        // ã‚«ãƒ¼ãƒ‰ã‚ãã‚Šå‡¦ç†
        function flipCard(cardEl, card) {
            if (cardEl.classList.contains('flipped') || 
                cardEl.classList.contains('matched') ||
                flippedCards.length >= 2) {
                return;
            }
            
            cardEl.classList.add('flipped');
            flippedCards.push({element: cardEl, card: card});
            
            // ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ãŸã¨ãã«éŸ³å£°èª­ã¿ä¸Šã’
            speakWord(card.type === 'word' ? card.content : card.word);
            
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 1000);
            }
        }

        // ãƒšã‚¢åˆ¤å®š
        function checkMatch() {
            const [first, second] = flippedCards;
            
            if (first.card.pairId === second.card.pairId) {
                // ãƒãƒƒãƒã—ãŸå ´åˆ
                first.element.classList.add('matched', 'celebration');
                second.element.classList.add('matched', 'celebration');
                
                matchedPairs++;
                matchCount.textContent = matchedPairs;
                
                // ãƒãƒƒãƒã—ãŸå˜èªã‚’è¡¨ç¤ºã—ã€èª­ã¿ä¸Šã’
                const wordCard = first.card.type === 'word' ? first.card : second.card;
                showMatch(wordCard);
                speakWord(wordCard.content);
                
                // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢åˆ¤å®š
                if (matchedPairs === totalPairs) {
                    setTimeout(() => {
                        stopTimer();
                        showClearScreen();
                    }, 2000);
                }
            } else {
                // ãƒãƒƒãƒã—ãªã‹ã£ãŸå ´åˆ
                setTimeout(() => {
                    first.element.classList.remove('flipped');
                    second.element.classList.remove('flipped');
                }, 500);
            }
            
            flippedCards = [];
        }

        // ãƒãƒƒãƒè¡¨ç¤º
        function showMatch(wordCard) {
            matchedWord.textContent = wordCard.content;
            matchedMeaning.textContent = `(${wordCard.meaning})`;
            matchDisplay.classList.remove('hidden');
            matchDisplay.classList.add('pulse');
            
            setTimeout(() => {
                matchDisplay.classList.add('hidden');
                matchDisplay.classList.remove('pulse');
            }, 3000);
        }

        // éŸ³å£°èª­ã¿ä¸Šã’
        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // ã‚¯ãƒªã‚¢ç”»é¢è¡¨ç¤º
        function showClearScreen() {
            gameScreen.classList.add('hidden');
            clearScreen.classList.remove('hidden');
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            selectedCategories = [];
            categoryButtons.forEach(btn => btn.classList.remove('selected'));
            clearScreen.classList.add('hidden');
            categoryScreen.classList.remove('hidden');
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            updateUI();
        }

        // ã‚«ãƒ†ã‚´ãƒªé¸æŠã«æˆ»ã‚‹
        function backToCategory() {
            gameScreen.classList.add('hidden');
            categoryScreen.classList.remove('hidden');
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
        }

        // é…åˆ—ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ï¼‰
        window.removeCategory = removeCategory;
    </script>
</body>
</html>